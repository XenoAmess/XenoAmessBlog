---
title: 庆典、盛大筹备中
date: 2021-10-05 12:00:00
tags: [ '修行' ]
my: XenoAmess

---

## 0. 良好案例

### 0.1 良好的源代码引用

https://github.com/alibaba/arthas/blob/master/core/src/main/java/com/taobao/arthas/core/env/ConfigurablePropertyResolver.java

要点：

#### 0.1.1. 确认原代码协议

前去源代码仓库查看LICENSE/LICENCE(.md/MD)文件，确认许可协议，选择许可协议允许的源代码引用方式

#### 0.1.2. 对于GPL等不允许的协议的源代码

使用合法隔离技巧

#### 0.1.3. 对于APACHE2 MIT BSD等BSD-like协议的源代码

按照license描述行事，不要违反禁忌，不要超出许可范围

BSD-like协议的一般通用禁忌：

1. 篡改作者名（冒名）
2. 篡改问津中的licence header（如果有）

## 1. [easyexcel](https://github.com/alibaba/easyexcel)

### 1.1 refines

https://github.com/xenoamess-fork/easyexcel/tree/reduce_unneed_java.lang.Short_shortValue

削减一次多余的java.lang.Short#shortValue调用

https://github.com/xenoamess-fork/easyexcel/tree/reduce_unneed_indexOf

削减一次多余的java.lang.String#indexOf调用

https://github.com/xenoamess-fork/easyexcel/tree/use_Map%23computeIfAbsent

使用Map#computeIfAbsent

https://github.com/xenoamess-fork/easyexcel/tree/make_inner_class_CellFormatResultWrapper_be_static

将内部类类CellFormatResultWrapper变为内部静态类

https://github.com/xenoamess-fork/easyexcel/tree/do_not_use_String.trim().length()

不要使用String.trim().length()来判空，效率低&消耗内存高&晦涩。请使用你们从commons-lang抄来的isBlank和isNotBlank

### 1.2 bugs

https://github.com/xenoamess-fork/easyexcel/tree/Iterable%23iterator_should_never_return_null

Iterable#iterator不应返回null

https://github.com/xenoamess-fork/easyexcel/tree/log_with_reason_cannot_use_%7B%7D

Logger系接口，如果要传reason，message就不能使用占位

### 1.3 license滥用

src/main/java/com/alibaba/excel/util/StringUtils.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/StringUtils.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/Validate.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/Validate.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/MemberUtils.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/reflect/MemberUtils.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/MapUtils.java

文件明显抄袭了guava中的guava/src/com/google/common/collect/Maps.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/ListUtils.java

文件明显抄袭了guava中的guava/src/com/google/common/collect/Lists.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/IntUtils.java

文件明显抄袭了guava中的guava/src/com/google/common/primitives/Ints.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/FileUtils.java

文件明显抄袭了commons-io中的src/main/java/org/apache/commons/io/FileUtils.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/FieldUtils.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/reflect/FieldUtils.java, 但是抹除了原项目的版权信息

src/main/java/com/alibaba/excel/util/BooleanUtils.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/BooleanUtils.java, 但是抹除了原项目的版权信息

## 2. [arthas](https://github.com/alibaba/arthas)

[comment]: <> (for Terenas Menethil the king!)

### 2.1 refines

https://github.com/xenoamess-fork/arthas/tree/refine_collection_creations

集合类创建相关优化

https://github.com/xenoamess-fork/arthas/tree/use_System%23currentTimeMillis_instead_of_new_Date().getTime()

使用System.currentTimeMillis()，而不是new Date().getTime()

https://github.com/xenoamess-fork/arthas/tree/use_generic_on_class_NoOpHandler

对类NoOpHandler添加泛型

https://github.com/xenoamess-fork/arthas/tree/simplify_condition

简化了条件判断

https://github.com/xenoamess-fork/arthas/tree/refine_error_logs

改良了错误捕捉

https://github.com/xenoamess-fork/arthas/tree/remove_unused_imports

去除未使用的import

https://github.com/xenoamess-fork/arthas/tree/use_StringBuilder_instead_of_StringBuffer_when_can

当可以的时候，使用StringBuilder而不是StringBuffer

https://github.com/xenoamess-fork/arthas/tree/use_static_inner_class_when_can

当可以的时候，使用静态内部类

https://github.com/xenoamess-fork/arthas/tree/numeric_issues

修复了数学计算中的问题

https://github.com/xenoamess-fork/arthas/tree/collection_issues

容器使用中的其他问题

https://github.com/xenoamess-fork/arthas/tree/string_concat_in_StringBuilder_append_chain

在StringBuilder调用链中使用了String拼接

https://github.com/xenoamess-fork/arthas/tree/do_NOT_create_wrapper_type_instance_when_can

能直接使用primitive type就不要包一层包装类

https://github.com/xenoamess-fork/arthas/tree/reduce_memory_use_in_Base64Command

能直接使用primitive type就不要包一层包装类

https://github.com/xenoamess-fork/arthas/tree/reduce_memory_waste_in_UserStatUtil

减少无意义内存浪费

https://github.com/xenoamess-fork/arthas/tree/thread_safety_bug

典型错误使用volatile案例

https://github.com/xenoamess-fork/arthas/tree/use_Arrays.fill

使用Arrays中已有的方法来提高可读性（如果可以的话）

https://github.com/xenoamess-fork/arthas/tree/String_function_shortcuts

一些写法的可读性更好，性能同等或者略好的写法

### 2.2 bugs

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_ArthasBootstrap

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_ArthasReflectUtils

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_Base64Command

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potensial_NPE_in_BasicHttpAuthenticatorHandler

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_Bootstrap

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potensial_NPE_in_CompletionUtils

一个NPE

https://github.com/xenoamess-fork/arthas/tree/logic_bug_in_Decompiler

一个逻辑bug

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_PackageInternalsFinder

一个NPE

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_RedisTunnelClusterStore

一个NPE

另，一个逻辑bug：使用HashSet作为有顺序的容器

https://github.com/xenoamess-fork/arthas/tree/potential_NPE_in_TunnelSocketFrameHandler

一个NPE

https://github.com/xenoamess-fork/arthas/tree/log_with_reason_cannot_use_%7B%7D

Logger系接口，如果要传reason，message就不能使用占位

### 2.3 license滥用

core/src/main/java/com/taobao/arthas/core/util/StringUtils.java

文件明显抄袭了commons-lang3中的src/main/java/org/apache/commons/lang3/StringUtils.java, 但是抹除了原项目的版权信息

有的是改改然后换掉javadoc，有的就是硬搬了，例如那几个doc里标着@since 3.0的
